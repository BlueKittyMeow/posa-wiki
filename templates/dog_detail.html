{% extends "base.html" %}

{% block title %}{{ dog.name }} - Posa Wiki{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <div>
            <div style="margin-bottom: 0.5rem;">
                <a href="{{ url_for('dogs_list') }}" class="btn btn-secondary" style="font-size: 0.85rem; padding: 0.25rem 0.75rem;">← Back to Dogs</a>
            </div>
            <h2 class="card-title">
                🐾 {{ dog.name }}
            </h2>
            <p class="text-muted">{{ pagination.total }} videos</p>
        </div>
        <button class="btn btn-secondary" onclick="editDog({{ dog.dog_id }})">✏️ Edit</button>
    </div>

    <!-- Dog Photo -->
    {% if dog.photo_visible and (dog.photo_local_path or dog.photo_url) %}
        <div style="margin-bottom: 1.5rem; text-align: center;">
            <img
                src="{{ url_for('static', filename=dog.photo_local_path) if dog.photo_local_path else dog.photo_url }}"
                alt="{{ dog.name }}"
                style="max-width: 400px; max-height: 500px; border-radius: var(--border-radius); box-shadow: 0 4px 12px rgba(0,0,0,0.15);"
                onerror="this.style.display='none';"
            />
        </div>
    {% endif %}

    <!-- Dog Info -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
        {% if dog.breed_primary %}
            <div>
                <strong class="text-accent">🐕 Breed:</strong>
                <span>{{ dog.breed_primary }}{% if dog.breed_secondary %} / {{ dog.breed_secondary }}{% endif %}</span>
            </div>
        {% endif %}
        
        {% if dog.color %}
            <div>
                <strong class="text-accent">🎨 Color:</strong>
                <span>{{ dog.color }}</span>
            </div>
        {% endif %}
        
        {% if dog.birth_date %}
            <div>
                <strong class="text-accent">🎂 Birth Date:</strong>
                <span>{{ dog.birth_date }}</span>
            </div>
        {% endif %}
    </div>

    {% if dog.description %}
        <div style="background: var(--bg-tertiary); padding: 1.5rem; border-radius: var(--border-radius); margin-bottom: 1.5rem;">
            <h4 class="text-accent" style="margin-bottom: 1rem;">📝 About {{ dog.name }}</h4>
            <p>{{ dog.description }}</p>
        </div>
    {% endif %}
</div>

<!-- Videos featuring this dog -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title">🎬 Adventures with {{ dog.name }}</h3>
        <div style="display: flex; gap: 0.5rem; align-items: center;">
            <span class="text-muted">{{ pagination.total }} videos</span>
            <select onchange="sortDogVideos(this.value)" id="video-sort">
                <option value="date_desc">📅 Newest First</option>
                <option value="date_asc">📅 Oldest First</option>
                <option value="title_asc">🔤 A-Z</option>
                <option value="title_desc">🔤 Z-A</option>
            </select>
        </div>
    </div>

    {% if videos %}
        {% from "_macros.html" import render_video_card %}
        <div class="video-grid" id="videos-container">
            {% for video in videos %}
                {{ render_video_card(video) }}
            {% endfor %}
        </div>

        <div class="pagination-container">
            {{ pagination.links }}
        </div>
    {% else %}
        <div class="text-center" style="padding: 3rem;">
            <p class="text-muted">No videos found featuring {{ dog.name }}.</p>
        </div>
    {% endif %}
</div>

<!-- Edit Dog Modal (placeholder) -->
<div id="edit-dog-modal" class="modal-backdrop" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center;">
    <div class="card" style="width: 90%; max-width: 500px; margin: 0;">
        <div class="card-header">
            <h3 class="card-title">✏️ Edit {{ dog.name }}</h3>
            <button onclick="closeModal('edit-dog-modal')" class="btn btn-secondary">✕</button>
        </div>
        
        <form>
            <div class="form-group mb-2">
                <label class="form-label">Dog Name</label>
                <input type="text" value="{{ dog.name }}" style="width: 100%;">
            </div>

            <div class="form-group mb-2">
                <label class="form-label">Description</label>
                <textarea rows="3" style="width: 100%;">{{ dog.description or '' }}</textarea>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label class="form-label">Primary Breed</label>
                    <input type="text" value="{{ dog.breed_primary or '' }}" style="width: 100%;">
                </div>

                <div class="form-group">
                    <label class="form-label">Color</label>
                    <input type="text" value="{{ dog.color or '' }}" style="width: 100%;">
                </div>
            </div>

            <div class="form-group mb-2">
                <label class="form-label">Birth Date</label>
                <input type="date" value="{{ dog.birth_date or '' }}" style="width: 100%;">
            </div>

            <div class="form-group mb-2">
                <label class="form-label">📷 Photo URL</label>
                <input type="url" value="{{ dog.photo_url or '' }}" placeholder="https://..." style="width: 100%;">
            </div>

            <div class="form-group mb-2">
                <label class="form-label">📁 Upload Photo</label>
                <input type="file" accept="image/jpeg,image/png,image/webp" style="width: 100%;">
                <small class="text-muted" style="font-size: 0.75rem;">JPG, PNG, or WebP</small>
            </div>

            <div class="form-group mb-2" style="display: flex; align-items: center; gap: 0.5rem;">
                <input type="checkbox" id="photo-visible" {{ 'checked' if dog.photo_visible else '' }}>
                <label for="photo-visible" class="form-label" style="margin: 0;">Photo Visible (uncheck to hide for privacy)</label>
            </div>

            <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1.5rem;">
                <button type="button" onclick="closeModal('edit-dog-modal')" class="btn btn-secondary">Cancel</button>
                <button type="submit" class="btn">Save Changes</button>
            </div>
        </form>
    </div>
</div>

<script>
function editDog(dogId) {
    openModal('edit-dog-modal');
}

function sortDogVideos(sortType) {
    const container = document.getElementById('videos-container');
    const cards = Array.from(container.children);
    
    cards.sort((a, b) => {
        switch(sortType) {
            case 'date_desc':
                return new Date(b.dataset.date) - new Date(a.dataset.date);
            case 'date_asc':
                return new Date(a.dataset.date) - new Date(b.dataset.date);
            case 'title_asc':
                return a.dataset.title.localeCompare(b.dataset.title);
            case 'title_desc':
                return b.dataset.title.localeCompare(a.dataset.title);
            default:
                return 0;
        }
    });
    
    container.innerHTML = '';
    cards.forEach(card => container.appendChild(card));
}
</script>
{% endblock %}